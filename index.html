<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BillGen - Quotation & Invoice Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body x-data="billApp()">

    <!-- Auth Overlay -->
    <template x-if="!user">
        <div class="fixed inset-0 z-[200] bg-slate-900 flex items-center justify-center p-4 overflow-y-auto">
            <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl p-8 transform transition-all">
                <div class="text-center mb-8">
                    <div class="inline-flex p-4 bg-blue-600 rounded-2xl mb-4">
                        <i data-lucide="file-text" class="text-white w-8 h-8"></i>
                    </div>
                    <h1 class="text-3xl font-black text-slate-900" x-text="isLogin ? 'Welcome Back' : 'Create Account'">
                    </h1>
                    <p class="text-slate-500 font-medium mt-2"
                        x-text="isLogin ? 'Sign in to access your billings' : 'Register to start managing your GST filings'">
                    </p>
                </div>

                <form @submit.prevent="isLogin ? signIn() : signUp()" class="space-y-4">
                    <template x-if="!isLogin">
                        <div class="space-y-1">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest pl-1">Full
                                Name</label>
                            <input type="text" x-model="authName" required
                                class="w-full px-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all font-medium">
                        </div>
                    </template>

                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest pl-1">Email
                            Address</label>
                        <input type="email" x-model="authEmail" required
                            class="w-full px-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all font-medium">
                    </div>

                    <div class="space-y-1">
                        <label
                            class="text-[10px] font-black uppercase text-slate-400 tracking-widest pl-1">Password</label>
                        <input type="password" x-model="authPassword" required
                            class="w-full px-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all font-medium">
                    </div>

                    <button type="submit" :disabled="authLoading"
                        class="w-full py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-2xl font-black text-lg shadow-xl shadow-blue-500/20 transition-all flex items-center justify-center space-x-2">
                        <template x-if="!authLoading">
                            <span x-text="isLogin ? 'Sign In' : 'Create Account'"></span>
                        </template>
                        <template x-if="authLoading">
                            <svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"
                                    fill="none"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                        </template>
                    </button>
                </form>

                <div class="mt-8 text-center bg-slate-50 rounded-2xl p-4">
                    <p class="text-sm font-medium text-slate-500">
                        <span x-text="isLogin ? 'New to BillGen?' : 'Already have an account?'"></span>
                        <button @click="isLogin = !isLogin"
                            class="text-blue-600 font-black ml-1 hover:underline outline-none"
                            x-text="isLogin ? 'Register now' : 'Sign in'"></button>
                    </p>
                </div>
            </div>
        </div>
    </template>

    <!-- Hidden File Input for Import -->
    <input type="file" id="importFile" accept=".json" class="hidden" @change="importData($event)">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 no-print">
        <div class="max-w-[1400px] mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="bg-blue-600 p-2 rounded-lg">
                    <i data-lucide="file-text" class="text-white w-6 h-6"></i>
                </div>
                <span class="heading-font font-bold text-xl text-slate-900">BillGen</span>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Data Actions 
                <div class="flex items-center space-x-2 border-r border-slate-200 pr-4 mr-2">
                    <button @click="exportData()" title="Backup Data"
                        class="text-slate-500 hover:text-blue-600 p-2 hover:bg-blue-50 rounded-full transition-all">
                        <i data-lucide="download" class="w-5 h-5"></i>
                    </button>
                    <button @click="document.getElementById('importFile').click()" title="Restore Data"
                        class="text-slate-500 hover:text-green-600 p-2 hover:bg-green-50 rounded-full transition-all">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                    </button>
                </div>-->

                <button @click="showDashboard = true; loadHistory();"
                    class="text-slate-600 hover:text-blue-600 font-medium text-sm transition-colors flex items-center">
                    <i data-lucide="layout-dashboard" class="w-4 h-4 mr-1"></i>
                    Dashboard
                </button>

                <div class="h-6 w-px bg-slate-200 ml-3"></div>

                <button @click="showHistory = true"
                    class="ml-3 text-slate-600 hover:text-blue-600 font-medium text-sm transition-colors flex items-center">
                    <i data-lucide="history" class="w-4 h-4 mr-1"></i>
                    History
                </button>

                <button @click="showSettings = true" title="Settings" x-show="isAdmin()"
                    class="text-slate-600 hover:text-slate-800 font-medium text-sm transition-colors flex items-center ml-3">
                    <i data-lucide="settings" class="w-4 h-4 mr-1"></i>
                    Settings
                </button>
                <div class="h-6 w-px bg-slate-200" x-show="isAdmin()"></div>
                <button @click="showGstDashboard = true" x-show="isAdmin() || isAccountant()"
                    class="text-slate-600 hover:text-blue-600 font-medium text-sm transition-colors flex items-center ml-3">
                    <i data-lucide="shield-check" class="w-4 h-4 mr-1"></i>
                    GST Compliance
                </button>
                <div class="h-6 w-px bg-slate-200 ml-3" x-show="isAdmin() || isAccountant()"></div>
                <button @click="saveDocToHistory()"
                    class="text-slate-600 hover:text-green-600 font-medium text-sm transition-colors flex items-center"
                    title="Save to History">
                    <i data-lucide="save" class="w-4 h-4 mr-1"></i>
                    Save Draft
                </button>

                <!-- Email Button -->
                <button @click="openEmailClient()"
                    class="text-slate-600 hover:text-indigo-600 font-medium text-sm transition-colors flex items-center"
                    title="Draft Email">
                    <i data-lucide="mail" class="w-4 h-4 mr-1"></i>
                    Email
                </button>

                <button @click="savePDF()" :disabled="isSaving"
                    class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white px-6 py-2 rounded-lg transition-all font-bold shadow-lg shadow-blue-200 min-w-[160px] justify-center">
                    <template x-if="!isSaving">
                        <div class="flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                            <span>Save PDF</span>
                        </div>
                    </template>
                    <template x-if="isSaving">
                        <div class="flex items-center">
                            <svg class="animate-spin h-5 w-5 mr-2 text-white" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"
                                    fill="none"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <span>Processing...</span>
                        </div>
                    </template>
                </button>

                <!-- User Profile & Sign Out -->
                <div class="h-6 w-px bg-slate-200 ml-3"></div>
                <div class="flex items-center space-x-3 ml-4 bg-slate-50 px-4 py-2 rounded-2xl border border-slate-100">
                    <div class="flex flex-col items-end">
                        <span class="text-xs font-black text-slate-900 leading-tight"
                            x-text="profile?.full_name || 'Staff'"></span>
                        <span class="text-[9px] font-black uppercase tracking-widest text-blue-600 leading-none"
                            x-text="profile?.role || 'User'"></span>
                    </div>
                    <button @click="signOut()"
                        class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all border border-transparent hover:border-red-100"
                        title="Sign Out">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Executive Dashboard Modal -->
    <div x-show="showDashboard" style="display: none;"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900 no-print"
        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100">

        <div class="bg-white w-full h-full flex flex-col overflow-hidden" @click.away="showDashboard = false"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="scale-105 opacity-0"
            x-transition:enter-end="scale-100 opacity-100">

            <!-- Header -->
            <div class="px-10 py-8 bg-slate-900 text-white flex items-center justify-between relative overflow-hidden">
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl">
                </div>
                <div class="flex items-center space-x-5 relative z-10">
                    <div
                        class="bg-gradient-to-br from-blue-500 to-indigo-600 p-4 rounded-2xl shadow-lg shadow-blue-500/20">
                        <i data-lucide="layout-dashboard" class="w-8 h-8 text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl font-black heading-font tracking-tight">Executive Insights Hub</h2>
                        <p class="text-slate-400 font-medium text-sm">Real-time business performance & revenue analytics
                        </p>
                    </div>
                </div>
                <button @click="showDashboard = false"
                    class="p-3 hover:bg-white/10 rounded-2xl transition-all border border-white/10 group relative z-10">
                    <i data-lucide="x"
                        class="w-6 h-6 text-white group-hover:rotate-90 transition-transform duration-300"></i>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-10 bg-slate-50/50 space-y-10">

                <!-- Main KPI Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div
                        class="bg-white p-8 rounded-[32px] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <span class="p-2 bg-blue-50 rounded-xl text-blue-600"><i data-lucide="trending-up"
                                    class="w-5 h-5"></i></span>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Monthly
                                Revenue</span>
                        </div>
                        <h3 class="text-3xl font-black text-slate-900 mb-1"
                            x-text="formatCurrency(dashboardStats.monthlyRevenue)"></h3>
                        <p class="text-xs font-bold text-slate-400">Current Month Revenue</p>
                    </div>

                    <div
                        class="bg-white p-8 rounded-[32px] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <span class="p-2 bg-indigo-50 rounded-xl text-indigo-600"><i data-lucide="calendar"
                                    class="w-5 h-5"></i></span>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">FY
                                Revenue</span>
                        </div>
                        <h3 class="text-3xl font-black text-slate-900 mb-1"
                            x-text="formatCurrency(dashboardStats.annualRevenue)"></h3>
                        <p class="text-xs font-bold text-slate-400"
                            x-text="'Apr ' + new Date().getFullYear() + ' - Mar ' + (new Date().getFullYear() + 1)"></p>
                    </div>

                    <div
                        class="bg-white p-8 rounded-[32px] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-l-4 border-l-red-500">
                        <div class="flex items-center justify-between mb-4">
                            <span class="p-2 bg-red-50 rounded-xl text-red-600"><i data-lucide="clock"
                                    class="w-5 h-5"></i></span>
                            <span
                                class="text-[10px] font-black uppercase tracking-widest text-slate-400">Outstanding</span>
                        </div>
                        <h3 class="text-3xl font-black text-red-600 mb-1"
                            x-text="formatCurrency(dashboardStats.outstanding)">
                        </h3>
                        <p class="text-xs font-bold text-slate-400">Uncollected Payments</p>
                    </div>

                    <div
                        class="bg-white p-8 rounded-[32px] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-l-4 border-l-green-500">
                        <div class="flex items-center justify-between mb-4">
                            <span class="p-2 bg-green-50 rounded-xl text-green-600"><i data-lucide="check-circle"
                                    class="w-5 h-5"></i></span>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Conversion
                                Rate</span>
                        </div>
                        <h3 class="text-3xl font-black text-green-600 mb-1"
                            x-text="dashboardStats.conversion.rate.toFixed(1) + '%'"></h3>
                        <p class="text-xs font-bold text-slate-400"
                            x-text="dashboardStats.conversion.invoices + ' Invoices from ' + dashboardStats.conversion.quotes + ' Quotes'">
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                    <!-- Top Customers -->
                    <div
                        class="bg-white rounded-[40px] border border-slate-100 shadow-sm overflow-hidden flex flex-col">
                        <div class="p-8 border-b border-slate-50 bg-slate-50/50 flex items-center justify-between">
                            <h3 class="text-xl font-black text-slate-800 flex items-center">
                                <i data-lucide="users" class="w-5 h-5 mr-3 text-blue-500"></i>
                                Top 5 Customers
                            </h3>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">By Taxable
                                Value</span>
                        </div>
                        <div class="p-8 space-y-4">
                            <template x-for="(c, idx) in dashboardStats.topCustomers" :key="idx">
                                <div
                                    class="flex items-center justify-between p-4 rounded-2xl hover:bg-slate-50 transition-all border border-transparent hover:border-slate-100">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-black text-slate-500 text-xs"
                                            x-text="idx + 1"></div>
                                        <span class="font-bold text-slate-700" x-text="c.name"></span>
                                    </div>
                                    <span class="font-black text-slate-900" x-text="formatCurrency(c.value)"></span>
                                </div>
                            </template>
                            <template x-if="dashboardStats.topCustomers.length === 0">
                                <div class="text-center py-10 text-slate-400 italic">No customer data available yet.
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Collections Progress -->
                    <div class="bg-white rounded-[40px] border border-slate-100 shadow-sm overflow-hidden">
                        <div class="p-8 border-b border-slate-50 bg-slate-50/50">
                            <h3 class="text-xl font-black text-slate-800 flex items-center">
                                <i data-lucide="pie-chart" class="w-5 h-5 mr-3 text-indigo-500"></i>
                                Collections Status
                            </h3>
                        </div>
                        <div class="p-10 flex flex-col items-center justify-center space-y-8">
                            <div class="relative w-48 h-48 flex items-center justify-center">
                                <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="96" cy="96" r="80" stroke="currentColor" stroke-width="20"
                                        fill="transparent" class="text-slate-100" />
                                    <circle cx="96" cy="96" r="80" stroke="currentColor" stroke-width="20"
                                        fill="transparent" :stroke-dasharray="2 * Math.PI * 80"
                                        :stroke-dashoffset="2 * Math.PI * 80 * (1 - (dashboardStats.collected / (dashboardStats.collected + dashboardStats.outstanding || 1)))"
                                        class="text-indigo-600 transition-all duration-1000" />
                                </svg>
                                <div class="absolute flex flex-col items-center">
                                    <span class="text-3xl font-black text-slate-900"
                                        x-text="(dashboardStats.collected / (dashboardStats.collected + dashboardStats.outstanding || 1) * 100).toFixed(0) + '%'"></span>
                                    <span
                                        class="text-[10px] font-black uppercase tracking-widest text-slate-400">Collected</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-8 w-full">
                                <div class="text-center">
                                    <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1">
                                        Total Collected</p>
                                    <p class="text-xl font-black text-green-600"
                                        x-text="formatCurrency(dashboardStats.collected)"></p>
                                </div>
                                <div class="text-center">
                                    <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1">
                                        Total Outstanding</p>
                                    <p class="text-xl font-black text-red-600"
                                        x-text="formatCurrency(dashboardStats.outstanding)"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Document Ledger Tabs -->
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-black text-slate-800 flex items-center">
                            <i data-lucide="book-open" class="w-6 h-6 mr-3 text-blue-600"></i>
                            Document Ledger
                        </h3>

                        <div class="flex bg-slate-100 p-1 rounded-2xl border border-slate-200">
                            <template x-for="(docs, type) in dashboardStats.docsByType" :key="type">
                                <button @click="dashboardStats.activeTab = type" :class="{
                                        'px-6 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all': true,
                                        'bg-white text-blue-600 shadow-sm': dashboardStats.activeTab === type,
                                        'text-slate-500 hover:text-slate-900': dashboardStats.activeTab !== type
                                    }" x-text="type">
                                </button>
                            </template>
                        </div>
                    </div>

                    <div class="bg-white rounded-[32px] border border-slate-100 shadow-sm overflow-hidden min-h-[400px]"
                        x-effect="dashboardStats.activeTab; ledgerControls.search; ledgerControls.startDate; ledgerControls.endDate; dashboardStats.docsByType; $nextTick(() => lucide.createIcons())">
                        <template x-for="(docs, type) in dashboardStats.docsByType" :key="type">
                            <div x-show="dashboardStats.activeTab === type"
                                x-transition:enter="transition ease-out duration-200"
                                x-transition:enter-start="opacity-0 translate-y-4"
                                x-transition:enter-end="opacity-100 translate-y-0">

                                <!-- Controls Toolbar -->
                                <div
                                    class="px-8 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wider"
                                        x-text="type + ' Registry'"></div>
                                    <div class="flex items-center space-x-3">
                                        <!-- Search -->
                                        <div class="relative group">
                                            <i data-lucide="search"
                                                class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                                            <input type="text" x-model="ledgerControls.search"
                                                class="pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-xs font-bold w-48 focus:w-64 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all"
                                                placeholder="Search...">
                                        </div>

                                        <!-- Date Range -->
                                        <div
                                            class="flex items-center space-x-2 bg-white border border-slate-200 rounded-xl px-2 py-1">
                                            <input type="date" x-model="ledgerControls.startDate"
                                                class="text-xs font-bold text-slate-600 outline-none w-24 bg-transparent">
                                            <span class="text-slate-300 font-bold">-</span>
                                            <input type="date" x-model="ledgerControls.endDate"
                                                class="text-xs font-bold text-slate-600 outline-none w-24 bg-transparent">
                                        </div>

                                        <!-- Export Button -->
                                        <button @click="exportLedgerTab(type)"
                                            class="flex items-center space-x-2 px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-xl hover:bg-green-100 transition-colors shadow-sm"
                                            title="Export current view to Excel">
                                            <i data-lucide="sheet" class="w-4 h-4"></i>
                                            <span class="text-xs font-bold">Export</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="text-[10px] font-black uppercase text-slate-400 bg-slate-50/50">
                                                <th class="px-8 py-4">Doc No.</th>
                                                <th class="px-8 py-4">Date</th>
                                                <th class="px-8 py-4">Customer</th>
                                                <th class="px-8 py-4 text-right">Grand Total</th>
                                                <th class="px-8 py-4 text-center">Status</th>
                                                <th class="px-8 py-4 text-center">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="text-sm">
                                            <template x-for="doc in getFilteredDocs(type)" :key="doc.number">
                                                <tr
                                                    class="border-t border-slate-50 hover:bg-slate-50/50 transition-colors group">
                                                    <td class="px-8 py-4 font-bold text-slate-900" x-text="doc.number">
                                                    </td>
                                                    <td class="px-8 py-4 text-slate-500" x-text="doc.date"></td>
                                                    <td class="px-8 py-4 font-medium text-slate-700"
                                                        x-text="doc.customer"></td>
                                                    <td class="px-8 py-4 text-right font-black text-slate-900"
                                                        x-text="formatCurrency(doc.total)"></td>
                                                    <td class="px-8 py-4 text-center">
                                                        <span :class="{
                                                            'px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest': true,
                                                            'bg-green-100 text-green-700': doc.status === 'PAID',
                                                            'bg-amber-100 text-amber-700': doc.status === 'UNPAID',
                                                            'bg-red-100 text-red-700': doc.status === 'OVERDUE' || doc.status === 'EXPIRED',
                                                            'bg-blue-100 text-blue-700': doc.status === 'CONVERTED'
                                                        }" x-text="doc.status || 'UNPAID'"></span>
                                                    </td>
                                                    <td
                                                        class="px-8 py-4 text-center flex items-center justify-center space-x-2">
                                                        <button @click="loadDocForView(doc.id)"
                                                            class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                                            title="View Document">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>

                                                        <template x-if="type === 'Quotation'">
                                                            <button @click="reviseDoc(doc.id)"
                                                                class="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                                                                title="Create Revision">
                                                                <i data-lucide="git-branch" class="w-4 h-4"></i>
                                                            </button>
                                                        </template>
                                                    </td>
                                                </tr>
                                            </template>
                                            <template x-if="getFilteredDocs(type).length === 0">
                                                <tr>
                                                    <td colspan="6"
                                                        class="px-8 py-20 text-center text-slate-400 italic">
                                                        <span
                                                            x-show="!ledgerControls.search && !ledgerControls.startDate">No
                                                            documents found.</span>
                                                        <span
                                                            x-show="ledgerControls.search || ledgerControls.startDate">No
                                                            matches found for your filter.</span>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Strategic Reminders -->
                <div
                    class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-[40px] p-8 text-white relative overflow-hidden group">
                    <div
                        class="absolute top-0 right-0 w-96 h-96 bg-blue-500/10 rounded-full translate-x-1/2 -translate-y-1/2 blur-3xl group-hover:scale-110 transition-transform duration-700">
                    </div>
                    <div class="flex items-center justify-between relative z-10">
                        <div class="space-y-2">
                            <h3 class="text-2xl font-black">Strategic Advice</h3>
                            <p class="text-slate-400 font-medium">Insights based on your current business cycle</p>
                        </div>
                        <template x-if="dashboardStats.conversion.rate < 30">
                            <div
                                class="flex items-center space-x-3 bg-red-500/10 border border-red-500/20 px-6 py-3 rounded-2xl">
                                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                <span class="font-bold text-red-400 text-sm">Low Quote Conversion. Review
                                    Pricing!</span>
                            </div>
                        </template>
                        <template x-if="dashboardStats.outstanding > dashboardStats.collected">
                            <div
                                class="flex items-center space-x-3 bg-amber-500/10 border border-amber-500/20 px-6 py-3 rounded-2xl">
                                <span class="w-2 h-2 rounded-full bg-amber-500 animate-pulse"></span>
                                <span class="font-bold text-amber-400 text-sm">Action Needed: High Outstanding
                                    Exposure.</span>
                            </div>
                        </template>
                        <template
                            x-if="dashboardStats.conversion.rate >= 30 && dashboardStats.outstanding <= dashboardStats.collected">
                            <div
                                class="flex items-center space-x-3 bg-green-500/10 border border-green-500/20 px-6 py-3 rounded-2xl">
                                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                <span class="font-bold text-green-400 text-sm">Operations Healthy. Keep Scaling!</span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- History Modal -->
    <div x-show="showHistory" style="display: none;"
        class="fixed inset-0 z-[100] flex items-center justify-end bg-black/50 backdrop-blur-sm transition-all"
        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">

        <div class="w-full max-w-md h-full bg-white shadow-2xl flex flex-col transform transition-transform"
            @click.away="showHistory = false" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="translate-x-0"
            x-transition:leave-end="translate-x-full">

            <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                <h2 class="text-xl font-bold text-slate-800 flex items-center">
                    <i data-lucide="history" class="w-5 h-5 mr-2 text-blue-600"></i>
                    Saved Documents
                </h2>
                <button @click="showHistory = false" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50/50">
                <template x-if="savedDocs.length === 0">
                    <div class="text-center py-10 text-slate-400">
                        <i data-lucide="folder-open" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                        <p>No saved documents found.</p>
                    </div>
                </template>

                <template x-for="(d, index) in savedDocs" :key="index">
                    <div
                        class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow group relative">
                        <!-- Delete Button -->
                        <button @click.stop="deleteHistoryDoc(index)"
                            class="absolute top-2 right-2 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                            title="Delete Record">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>

                        <!-- Convert Button (Only for Quotations) -->
                        <button @click.stop="convertHistoryDoc(d)" x-show="d.type === 'Quotation'"
                            class="absolute top-2 right-10 p-1.5 text-slate-300 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                            title="Convert to Tax Invoice">
                            <i data-lucide="arrow-right-circle" class="w-4 h-4"></i>
                        </button>

                        <!-- Duplicate Button -->
                        <button @click.stop="duplicateDoc(d)"
                            class="absolute top-2 right-18 p-1.5 text-slate-300 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                            style="right: 4.5rem;" title="Duplicate Document">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>

                        <div @click="loadHistoryDoc(index)" class="cursor-pointer">
                            <div class="flex items-center justify-between mb-2 pr-8">
                                <span
                                    class="text-xs font-bold px-2 py-0.5 rounded text-blue-700 bg-blue-50 border border-blue-100 uppercase tracking-tighter"
                                    x-text="d.type"></span>
                                <span class="text-[10px] text-slate-400 font-medium"
                                    x-text="new Date(d.savedAt).toLocaleDateString()"></span>
                            </div>
                            <h3 class="font-bold text-slate-800 mb-1" x-text="d.number || 'Untitled'"></h3>
                            <p class="text-sm text-slate-600 truncate mb-2" x-text="d.customer.name || 'No Customer'">
                            </p>

                            <div class="flex items-center justify-between border-t border-slate-100 pt-2 mt-2">
                                <span class="text-xs font-bold text-slate-500">Total:</span>
                                <span class="font-black text-slate-800"
                                    x-text="((this.currencies.find(c => c.code === (d.currency || 'INR')) || {symbol:'â‚¹'}).symbol) + ' ' + Number(d.items.reduce((sum, i) => { const taxable = (i.qty*i.rate) - ((d.type==='Quotation' ? (i.qty*i.rate*(i.discount||0)/100) : 0)); const rate = (i.taxRate !== undefined) ? i.taxRate : (d.taxRate !== undefined ? d.taxRate : 18); return sum + taxable + (taxable * (rate/100)); }, 0) + (Number(d.bankChargesAmount || 0))).toLocaleString(((this.currencies.find(c => c.code === (d.currency || 'INR')) || {locale:'en-IN'}).locale), {maximumFractionDigits:0})"></span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div x-show="showSettings" style="display: none;"
        class="fixed inset-0 z-[100] flex items-center justify-end bg-black/50 backdrop-blur-sm transition-all"
        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">

        <div class="w-full max-w-md h-full bg-white shadow-2xl flex flex-col transform transition-transform"
            @click.away="showSettings = false" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="translate-x-0"
            x-transition:leave-end="translate-x-full">

            <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                <h2 class="text-xl font-bold text-slate-800 flex items-center">
                    <i data-lucide="settings" class="w-5 h-5 mr-2 text-blue-600"></i>
                    Global Settings
                </h2>
                <button @click="showSettings = false" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-white">
                <div class="mb-4">
                    <h3 class="font-bold text-slate-800 mb-2">Company Details</h3>
                    <div class="p-3 border rounded-lg space-y-2">
                        <div>
                            <label class="text-xs text-slate-500">Company Name</label>
                            <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.name">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500">Tagline</label>
                            <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.tagline">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500">Address Line 1</label>
                            <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.address1">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500">Address Line 2</label>
                            <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.address2">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs text-slate-500">GSTIN</label>
                                <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.gstin">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500">PAN</label>
                                <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.pan">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs text-slate-500">Phone</label>
                                <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.phone">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500">Email</label>
                                <input type="text" class="w-full border rounded px-2 py-1" x-model="doc.company.email">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h3 class="font-bold text-slate-800 mb-2">Default Bank Accounts</h3>
                    <p class="text-sm text-slate-500 mb-3">Edit the default bank account details that will be applied to
                        new documents or when you click "Apply to Document".</p>

                    <div class="space-y-3">
                        <template x-for="code in ['USD','EUR']" :key="code">
                            <div class="p-3 border rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="font-bold">Default <span x-text="code"></span> Account</div>
                                    <div class="text-xs text-slate-400">Visible when currency is <span
                                            x-text="code"></span></div>
                                </div>
                                <div class="space-y-2">
                                    <div>
                                        <label class="text-xs text-slate-500">Name</label>
                                        <input type="text" class="w-full border rounded px-2 py-1"
                                            x-model="globalBanks[code].name">
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-500">Bank</label>
                                        <input type="text" class="w-full border rounded px-2 py-1"
                                            x-model="globalBanks[code].bankName">
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="text-xs text-slate-500">Branch</label>
                                            <input type="text" class="w-full border rounded px-2 py-1"
                                                x-model="globalBanks[code].branch">
                                        </div>
                                        <div>
                                            <label class="text-xs text-slate-500">Acc. Number</label>
                                            <input type="text" class="w-full border rounded px-2 py-1"
                                                x-model="globalBanks[code].acc">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-500">IFSC / SWIFT</label>
                                        <input type="text" class="w-full border rounded px-2 py-1"
                                            x-model="globalBanks[code].ifsc">
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="flex items-center space-x-3">
                    <button @click="saveGlobalBanks()" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
                    <button @click="resetGlobalBanks()" class="text-sm text-red-600">Reset to Samples</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GST Compliance Dashboard -->
    <div x-show="showGstDashboard" style="display: none;"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm no-print p-4">

        <div class="bg-white w-full max-w-5xl h-[90vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden"
            @click.away="showGstDashboard = false" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95">

            <!-- Header -->
            <div class="px-8 py-6 bg-slate-900 text-white flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-500 p-3 rounded-2xl">
                        <i data-lucide="shield-check" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black heading-font">GST Compliance Center</h2>
                        <p class="text-slate-400 text-sm font-medium">Indian GST Returns & Compliance Management</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="px-4 py-2 bg-slate-800 rounded-xl border border-slate-700 flex items-center space-x-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-xs font-bold uppercase tracking-wider"
                            x-text="gstSettings.taxpayerType"></span>
                    </div>
                    <button @click="showGstDashboard = false"
                        class="p-2 hover:bg-slate-800 rounded-xl transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="flex bg-slate-50 border-b border-slate-200 px-8">
                <button @click="gstView = 'returns'"
                    :class="gstView === 'returns' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'"
                    class="px-6 py-4 border-b-2 font-bold text-sm transition-all flex items-center space-x-2">
                    <i data-lucide="file-plus" class="w-4 h-4"></i>
                    <span>Tax Returns</span>
                </button>
                <button @click="gstView = 'calendar'"
                    :class="gstView === 'calendar' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'"
                    class="px-6 py-4 border-b-2 font-bold text-sm transition-all flex items-center space-x-2">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>Compliance Calendar</span>
                </button>
                <button @click="gstView = 'settings'"
                    :class="gstView === 'settings' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'"
                    class="px-6 py-4 border-b-2 font-bold text-sm transition-all flex items-center space-x-2">
                    <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                    <span>Registration & Types</span>
                </button>
                <button @click="gstView = 'history'"
                    :class="gstView === 'history' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'"
                    class="px-6 py-4 border-b-2 font-bold text-sm transition-all flex items-center space-x-2">
                    <i data-lucide="history" class="w-4 h-4"></i>
                    <span>Filing History</span>
                </button>
            </div>

            <!-- Dashboard Content -->
            <div class="flex-1 overflow-y-auto p-8 bg-slate-50/30">

                <!-- Returns Tab -->
                <template x-if="gstView === 'returns'">
                    <div class="space-y-6">
                        <!-- Summary Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Total Taxable Value</p>
                                <h3 class="text-2xl font-black text-slate-900"
                                    x-text="formatCurrency(getGstDashboardStats().totalTaxable)"></h3>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                <p class="text-slate-500 text-xs font-bold uppercase mb-2">Total GST Collected</p>
                                <h3 class="text-2xl font-black text-blue-600"
                                    x-text="formatCurrency(getGstDashboardStats().totalGst)"></h3>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                <p class="text-slate-500 text-xs font-bold uppercase mb-2">B2B Invoices</p>
                                <h3 class="text-2xl font-black text-slate-900" x-text="getGstDashboardStats().b2bCount">
                                </h3>
                            </div>
                            <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                <p class="text-slate-500 text-xs font-bold uppercase mb-2">B2C Invoices</p>
                                <h3 class="text-2xl font-black text-slate-900" x-text="getGstDashboardStats().b2cCount">
                                </h3>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- GSTR-1 Card -->
                            <div class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden">
                                <div class="px-6 py-4 bg-slate-900 text-white flex items-center justify-between">
                                    <h3 class="font-black">GSTR-1 (Sales Return)</h3>
                                    <span
                                        class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded border border-blue-500/30 font-bold uppercase">Critical</span>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div
                                        class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                        <div class="flex items-center space-x-3">
                                            <div class="bg-white p-2 rounded-xl shadow-sm"><i data-lucide="file-text"
                                                    class="w-5 h-5 text-slate-600"></i></div>
                                            <div>
                                                <p class="text-xs font-bold text-slate-500 uppercase">Current Month</p>
                                                <p class="font-bold text-slate-900">January 2026</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-[10px] font-bold text-red-500 uppercase">Due Date</p>
                                            <p class="font-bold text-slate-900"
                                                x-text="calculateGstDueDate('GSTR-1', 'Feb', 2026, gstSettings.filingFrequency) + ' Feb 2026'">
                                            </p>
                                        </div>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed">
                                        Includes details of all B2B and B2C outward supplies. This forms the basis for
                                        your liability and your recipient's credit.
                                    </p>
                                    <button @click="showGstr1Details = !showGstr1Details"
                                        class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black hover:bg-slate-800 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <span
                                            x-text="showGstr1Details ? 'Hide Invoice Details' : 'View Invoice Details'"></span>
                                    </button>
                                    <button @click="generateGstr1Json()"
                                        class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black hover:bg-blue-700 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                        <span>Download GSTR-1 Portal JSON</span>
                                    </button>
                                    <button @click="exportGstr1Excel()"
                                        class="w-full py-4 bg-emerald-600 text-white rounded-2xl font-black hover:bg-emerald-700 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                                        <span>Download GSTR-1 Excel</span>
                                    </button>
                                    <button @click="saveGstReturn('GSTR-1', 'DRAFT')"
                                        class="w-full py-2 text-xs font-bold text-slate-500 hover:text-blue-600 transition-all">
                                        Save Draft Record
                                    </button>
                                </div>
                            </div>

                            <!-- GSTR-3B Card -->
                            <div class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden">
                                <div class="px-6 py-4 bg-slate-900 text-white flex items-center justify-between">
                                    <h3 class="font-black">GSTR-3B (Summary Return)</h3>
                                    <span
                                        class="text-[10px] bg-amber-500/20 text-amber-500 px-2 py-0.5 rounded border border-amber-500/30 font-bold uppercase">Tax
                                        Payment</span>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div
                                        class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                        <div class="flex items-center space-x-3">
                                            <div class="bg-white p-2 rounded-xl shadow-sm"><i data-lucide="credit-card"
                                                    class="w-5 h-5 text-slate-600"></i></div>
                                            <div>
                                                <p class="text-xs font-bold text-slate-500 uppercase">Current Month</p>
                                                <p class="font-bold text-slate-900">January 2026</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-[10px] font-bold text-red-500 uppercase">Due Date</p>
                                            <p class="font-bold text-slate-900">20th Feb 2026</p>
                                        </div>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed">
                                        Summary of inward and outward supplies along with the input tax credit (ITC).
                                        Final tax payment is calculated here.
                                    </p>
                                    <button @click="showGstr3bPortal = !showGstr3bPortal"
                                        class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black hover:bg-slate-800 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <span
                                            x-text="showGstr3bPortal ? 'Hide Portal View' : 'View GSTR-3B Portal View'"></span>
                                    </button>
                                    <button @click="generateGstr3bJson()"
                                        class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black hover:bg-blue-700 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                        <span>Download GSTR-3B Summary JSON</span>
                                    </button>
                                    <button @click="exportGstr3bExcel()"
                                        class="w-full py-4 bg-emerald-600 text-white rounded-2xl font-black hover:bg-emerald-700 transition-all flex items-center justify-center space-x-2">
                                        <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                                        <span>Download GSTR-3B Excel</span>
                                    </button>
                                    <button @click="saveGstReturn('GSTR-3B', 'DRAFT')"
                                        class="w-full py-2 text-xs font-bold text-slate-500 hover:text-blue-600 transition-all">
                                        Save Draft Record
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Detailed Table (Conditional) -->
                        <div x-show="showGstr1Details" x-transition
                            class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden mt-8">
                            <div class="p-6 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
                                <h3 class="font-black text-slate-900 uppercase tracking-tight">GSTR-1 Draft Details</h3>
                            </div>
                            <div class="p-6 overflow-x-auto">
                                <h4 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">Section 4A,
                                    4B, 4C, 6B, 6C - B2B Invoices</h4>
                                <table class="w-full text-left border-collapse mb-8">
                                    <thead>
                                        <tr
                                            class="text-[10px] font-black uppercase text-slate-500 border-b border-slate-100">
                                            <th class="pb-3 px-2">Invoice No</th>
                                            <th class="pb-3 px-2">Date</th>
                                            <th class="pb-3 px-2">Customer Name</th>
                                            <th class="pb-3 px-2">GSTIN</th>
                                            <th class="pb-3 px-2 text-right">Taxable Value</th>
                                            <th class="pb-3 px-2 text-right">GST Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-[11px] font-medium text-slate-700">
                                        <template x-for="item in getGstr1Details().b2b">
                                            <tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                <td class="py-3 px-2 font-bold" x-text="item.number"></td>
                                                <td class="py-3 px-2" x-text="formatDate(item.date)"></td>
                                                <td class="py-3 px-2" x-text="item.name"></td>
                                                <td class="py-3 px-2" x-text="item.gstin"></td>
                                                <td class="py-3 px-2 text-right font-bold"
                                                    x-text="formatCurrency(item.taxable)"></td>
                                                <td class="py-3 px-2 text-right font-bold text-blue-600"
                                                    x-text="formatCurrency(item.gst)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>

                                <h4 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">Section 7 -
                                    B2C (Others)</h4>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="text-[10px] font-black uppercase text-slate-500 border-b border-slate-100">
                                            <th class="pb-3 px-2">Place of Supply</th>
                                            <th class="pb-3 px-2">Rate (%)</th>
                                            <th class="pb-3 px-2 text-right">Taxable Value</th>
                                            <th class="pb-3 px-2 text-right">IGST</th>
                                            <th class="pb-3 px-2 text-right">CGST</th>
                                            <th class="pb-3 px-2 text-right">SGST</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-[11px] font-medium text-slate-700">
                                        <template x-for="item in getGstr1Details().b2c">
                                            <tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                <td class="py-3 px-2 font-bold" x-text="item.pos"></td>
                                                <td class="py-3 px-2" x-text="item.rt + '%'"></td>
                                                <td class="py-3 px-2 text-right font-bold"
                                                    x-text="formatCurrency(item.txval)"></td>
                                                <td class="py-3 px-2 text-right" x-text="formatCurrency(item.iamt)">
                                                </td>
                                                <td class="py-3 px-2 text-right" x-text="formatCurrency(item.camt)">
                                                </td>
                                                <td class="py-3 px-2 text-right" x-text="formatCurrency(item.samt)">
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- GSTR-3B Portal View (Conditional) -->
                        <div x-show="showGstr3bPortal" x-transition
                            class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden mt-8">
                            <div class="p-6 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
                                <h3 class="font-black text-slate-900 uppercase tracking-tight">GSTR-3B Official Portal
                                    Snapshot
                                </h3>
                            </div>
                            <div class="p-6 space-y-8">
                                <div>
                                    <h4 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">3.1
                                        Details of
                                        Outward Supplies and inward supplies liable to reverse charge</h4>
                                    <table class="w-full text-left border-collapse">
                                        <thead>
                                            <tr
                                                class="text-[10px] font-black uppercase text-slate-500 border-b border-slate-100">
                                                <th class="py-3 px-2">Nature of Supplies</th>
                                                <th class="py-3 px-2 text-right">Total Taxable Value</th>
                                                <th class="py-3 px-2 text-right">IGST</th>
                                                <th class="py-3 px-2 text-right">CGST</th>
                                                <th class="py-3 px-2 text-right">SGST/UTGST</th>
                                            </tr>
                                        </thead>
                                        <tbody class="text-[11px] font-bold text-slate-700">
                                            <tr class="border-b border-slate-50">
                                                <td class="py-3 px-2" x-text="getGstr3bPortalData().table31.a.label">
                                                </td>
                                                <td class="py-3 px-2 text-right"
                                                    x-text="formatCurrency(getGstr3bPortalData().table31.a.val)"></td>
                                                <td class="py-3 px-2 text-right"
                                                    x-text="formatCurrency(getGstr3bPortalData().table31.a.tax)"></td>
                                                <td class="py-3 px-2 text-right"
                                                    x-text="formatCurrency(getGstr3bPortalData().table31.a.tax / 2)">
                                                </td>
                                                <td class="py-3 px-2 text-right"
                                                    x-text="formatCurrency(getGstr3bPortalData().table31.a.tax / 2)">
                                                </td>
                                            </tr>
                                            <template x-for="row in ['b','c','d','e']">
                                                <tr class="border-b border-slate-50 text-slate-400 font-normal">
                                                    <td class="py-3 px-2"
                                                        x-text="getGstr3bPortalData().table31[row].label">
                                                    </td>
                                                    <td class="py-3 px-2 text-right">0.00</td>
                                                    <td class="py-3 px-2 text-right">0.00</td>
                                                    <td class="py-3 px-2 text-right">0.00</td>
                                                    <td class="py-3 px-2 text-right">0.00</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="pt-8 border-t border-slate-100">
                                    <h4 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">4.
                                        Eligible ITC
                                    </h4>
                                    <table class="w-full text-left border-collapse">
                                        <thead>
                                            <tr
                                                class="text-[10px] font-black uppercase text-slate-500 border-b border-slate-100">
                                                <th class="py-3 px-2">Details</th>
                                                <th class="py-3 px-2 text-right">Total ITC</th>
                                            </tr>
                                        </thead>
                                        <tbody class="text-[11px] font-bold text-slate-700">
                                            <template x-for="row in ['a','b','c','d']">
                                                <tr class="border-b border-slate-50"
                                                    :class="row === 'a' || row === 'c' ? '' : 'text-slate-400 font-normal'">
                                                    <td class="py-3 px-2"
                                                        x-text="getGstr3bPortalData().table4[row].label"></td>
                                                    <td class="py-3 px-2 text-right">0.00</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Calendar Tab -->
                <template x-if="gstView === 'calendar'">
                    <div class="bg-white rounded-3xl border border-slate-200 shadow-sm p-8">
                        <h3 class="text-xl font-black text-slate-900 mb-6 flex items-center">
                            <i data-lucide="bell" class="w-6 h-6 mr-2 text-blue-600"></i>
                            Compliance Deadlines (Feb 2026)
                        </h3>
                        <div class="space-y-4">
                            <div
                                class="flex items-center justify-between p-6 bg-slate-50 rounded-3xl border-l-8 border-blue-600">
                                <div>
                                    <h4 class="font-black text-slate-900">GSTR-1 Filing</h4>
                                    <p class="text-sm text-slate-500">Statement of outward supplies for Jan 2026</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black text-slate-900"
                                        x-text="calculateGstDueDate('GSTR-1', 'Feb', 2026, gstSettings.filingFrequency)">
                                    </p>
                                    <p class="text-xs font-bold text-blue-600 uppercase">Upcoming</p>
                                </div>
                            </div>
                            <div
                                class="flex items-center justify-between p-6 bg-slate-50 rounded-3xl border-l-8 border-amber-500">
                                <div>
                                    <h4 class="font-black text-slate-900">GSTR-3B Filing</h4>
                                    <p class="text-sm text-slate-500">Summary return and payment of tax for Jan 2026</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black text-slate-900">20 Feb</p>
                                    <p class="text-xs font-bold text-red-500 uppercase">Mandatory</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Settings Tab -->
                <template x-if="gstView === 'settings'">
                    <div class="max-w-xl mx-auto space-y-8">
                        <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
                            <h3 class="text-xl font-black text-slate-900 mb-6">Taxpayer Registration</h3>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 mb-2">GST Registration
                                        Type</label>
                                    <select x-model="gstSettings.taxpayerType"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-3 font-bold text-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all">
                                        <option value="Regular">Regular Taxpayer</option>
                                        <option value="Composition">Composition Scheme</option>
                                        <option value="TDS/TCS">TDS/TCS Registered</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 mb-2">Filing Frequency</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <button @click="gstSettings.filingFrequency = 'Monthly'"
                                            :class="gstSettings.filingFrequency === 'Monthly' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200' : 'bg-slate-50 text-slate-500'"
                                            class="py-4 rounded-2xl font-black transition-all">Monthly</button>
                                        <button @click="gstSettings.filingFrequency = 'Quarterly'"
                                            :class="gstSettings.filingFrequency === 'Quarterly' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200' : 'bg-slate-50 text-slate-500'"
                                            class="py-4 rounded-2xl font-black transition-all">Quarterly (QRMP)</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Filing History Tab -->
                <template x-if="gstView === 'history'">
                    <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-slate-100 bg-slate-50 flex items-center justify-between">
                            <h3 class="font-black text-slate-900 uppercase tracking-tight">Persistent Return Registry
                            </h3>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="text-[10px] font-black uppercase text-slate-500 bg-slate-50/50">
                                        <th class="py-4 px-6 border-b border-slate-100">Return Type</th>
                                        <th class="py-4 px-6 border-b border-slate-100">Period</th>
                                        <th class="py-4 px-6 border-b border-slate-100">Status</th>
                                        <th class="py-4 px-6 border-b border-slate-100">Date Saved</th>
                                        <th class="py-4 px-6 border-b border-slate-100 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="text-xs font-medium text-slate-700">
                                    <template x-for="rec in gstHistory">
                                        <tr class="border-b border-slate-50 hover:bg-slate-50/50 transition-colors">
                                            <td class="py-4 px-6">
                                                <div class="flex items-center space-x-2">
                                                    <span class="w-2 h-2 rounded-full"
                                                        :class="rec.type === 'GSTR-1' ? 'bg-blue-500' : 'bg-amber-500'"></span>
                                                    <span class="font-bold text-slate-900" x-text="rec.type"></span>
                                                </div>
                                            </td>
                                            <td class="py-4 px-6" x-text="rec.period"></td>
                                            <td class="py-4 px-6">
                                                <span class="px-2 py-1 rounded-full text-[10px] font-black uppercase"
                                                    :class="rec.status === 'FILED' ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500'"
                                                    x-text="rec.status"></span>
                                            </td>
                                            <td class="py-4 px-6 text-slate-500" x-text="formatDate(rec.created_at)">
                                            </td>
                                            <td class="py-4 px-6 text-right">
                                                <button @click="viewGstReturnDetail(rec)"
                                                    class="text-blue-600 hover:text-blue-800 font-bold">View
                                                    Detail</button>
                                            </td>
                                        </tr>
                                    </template>
                                    <template x-if="gstHistory.length === 0">
                                        <tr>
                                            <td colspan="5" class="py-12 text-center text-slate-400 font-bold italic">
                                                No records found in the registry. Click "Save Draft" on a return to
                                                start
                                                tracking.
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>

                            <!-- HSN Summary Section -->
                            <div class="mt-8 pt-8 border-t border-slate-100">
                                <h4 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">Section 12
                                    -
                                    HSN-wise Summary of Outward Supplies</h4>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="text-[10px] font-black uppercase text-slate-500 border-b border-slate-100">
                                            <th class="pb-3 px-2">HSN/SAC</th>
                                            <th class="pb-3 px-2">Description</th>
                                            <th class="pb-3 px-2 text-right">Qty</th>
                                            <th class="pb-3 px-2 text-right">Taxable Value</th>
                                            <th class="pb-3 px-2 text-right">IGST</th>
                                            <th class="pb-3 px-2 text-right">CGST/SGST</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-[11px] font-medium text-slate-700">
                                        <template x-for="item in getHsnSummary()">
                                            <tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                                <td class="py-3 px-2 font-bold" x-text="item.hsn"></td>
                                                <td class="py-3 px-2 text-slate-500" x-text="item.desc"></td>
                                                <td class="py-3 px-2 text-right" x-text="item.qty"></td>
                                                <td class="py-3 px-2 text-right font-bold"
                                                    x-text="formatCurrency(item.taxable)"></td>
                                                <td class="py-3 px-2 text-right font-bold text-blue-600"
                                                    x-text="formatCurrency(item.iamt)"></td>
                                                <td class="py-3 px-2 text-right font-bold text-slate-400"
                                                    x-text="formatCurrency(item.camt)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </template>

            </div>
        </div>
    </div>

    <main class="max-w-[1400px] mx-auto px-4 py-6">
        <!-- Document Type Buttons -->
        <div class="no-print mb-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
            <button @click="setDocType('Quotation')"
                :class="doc.type === 'Quotation' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="file-text" class="w-4 h-4"></i>
                <span>Quotation</span>
            </button>
            <button @click="setDocType('Proforma Invoice')"
                :class="doc.type === 'Proforma Invoice' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="file-check" class="w-4 h-4"></i>
                <span>Proforma</span>
            </button>
            <button @click="setDocType('Tax Invoice')"
                :class="doc.type === 'Tax Invoice' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="file-check-2" class="w-4 h-4"></i>
                <span>Tax Invoice</span>
            </button>
            <button @click="setDocType('Delivery Challan')"
                :class="doc.type === 'Delivery Challan' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="truck" class="w-4 h-4"></i>
                <span>Challan</span>
            </button>
            <button @click="setDocType('Credit Note')"
                :class="doc.type === 'Credit Note' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="minus-square" class="w-4 h-4"></i>
                <span>Credit Note</span>
            </button>
            <button @click="setDocType('Debit Note')"
                :class="doc.type === 'Debit Note' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-600 ring-offset-2' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'"
                class="py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center space-x-2 text-xs">
                <i data-lucide="plus-square" class="w-4 h-4"></i>
                <span>Debit Note</span>
            </button>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">

            <!-- Editor Section -->
            <div class="lg:w-1/3 no-print space-y-6 overflow-y-auto max-h-[calc(100vh-200px)] pr-2">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <input type="text" placeholder="Enter Document Number" x-model="searchNumber"
                        class="border px-3 py-1 rounded w-64" />
                    <button @click="loadDocumentByNumber()" class="bg-blue-600 text-white px-3 py-1 rounded">
                        Load
                    </button>
                </div>

                <!-- Document Type & Meta -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="heading-font text-lg font-bold text-slate-800 flex items-center mb-0">
                            <i data-lucide="settings" class="w-5 h-5 mr-2 text-blue-500"></i>
                            Document Settings
                        </h2>
                        <button @click="resetDoc()" title="Reset Document"
                            class="text-red-500 hover:text-red-700 flex items-center text-xs font-bold transition-colors">
                            <i data-lucide="rotate-ccw" class="w-3 h-3 mr-1"></i>
                            RESET
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1"
                                    x-text="doc.type === 'Quotation' ? 'Quotation No.' : (doc.type === 'Proforma Invoice' ? 'Proforma No.' : (doc.type === 'Tax Invoice' ? 'Invoice No.' : 'Challan No.'))"></label>
                                <div class="relative">
                                    <input type="text" x-model="doc.number" @blur="checkDuplicateNumber()"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 pr-10 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div x-show="doc.type === 'Quotation'" class="mt-2 flex items-center space-x-2">
                                    <span class="text-xs font-bold text-slate-500 uppercase">Revision:</span>
                                    <div class="flex items-center -space-x-px">
                                        <button @click="doc.revision = Math.max(0, doc.revision - 1); applyRevision()"
                                            class="p-1 border border-slate-200 rounded-l hover:bg-slate-50 text-slate-600">
                                            <i data-lucide="minus" class="w-3 h-3"></i>
                                        </button>
                                        <div class="border-y border-slate-200 px-3 py-0.5 text-xs font-bold text-blue-600 bg-blue-50/50"
                                            x-text="'R' + doc.revision"></div>
                                        <button @click="doc.revision++; applyRevision()"
                                            class="p-1 border border-slate-200 rounded-r hover:bg-slate-50 text-slate-600">
                                            <i data-lucide="plus" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1"
                                    x-text="doc.type === 'Quotation' ? 'Quotation Date' : (doc.type === 'Proforma Invoice' ? 'Proforma Date' : (doc.type === 'Tax Invoice' ? 'Invoice Date' : 'Challan Date'))"></label>
                                <input type="date" x-model="doc.date"
                                    class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>

                        <!-- Currency Selector -->
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Currency</label>
                            <select x-model="doc.currency" @change="lucide.createIcons()"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                <template x-for="curr in currencies" :key="curr.code">
                                    <option :value="curr.code"
                                        x-text="curr.code + ' - ' + curr.name + ' (' + curr.symbol + ')'"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Print Settings -->
                        <div class="pt-4 border-t border-slate-100">
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Print Settings
                                (Signature/Stamps)</label>
                            <div class="flex flex-wrap gap-4">
                                <label class="flex items-center cursor-pointer">
                                    <div class="relative">
                                        <input type="checkbox" x-model="doc.settings.showSignature"
                                            class="peer sr-only">
                                        <div
                                            class="w-9 h-5 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                        </div>
                                    </div>
                                    <span class="ml-2 text-sm text-slate-700">Signature</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <div class="relative">
                                        <input type="checkbox" x-model="doc.settings.showCompanyStamp"
                                            class="peer sr-only">
                                        <div
                                            class="w-9 h-5 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                        </div>
                                    </div>
                                    <span class="ml-2 text-sm text-slate-700">Round Stamp</span>
                                </label>
                                <label class="flex items-center cursor-pointer" x-show="doc.type === 'Tax Invoice'">
                                    <div class="relative">
                                        <input type="checkbox" x-model="doc.settings.showRevenueStamp"
                                            class="peer sr-only">
                                        <div
                                            class="w-9 h-5 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600">
                                        </div>
                                    </div>
                                    <span class="ml-2 text-sm text-slate-700">Rev. Stamp</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Details -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="heading-font text-lg font-bold text-slate-800 flex items-center">
                            <i data-lucide="user" class="w-5 h-5 mr-2 text-blue-500"></i>
                            Customer Details
                        </h2>
                        <button @click="saveToMaster('customer')" title="Save to Master"
                            class="p-1.5 text-slate-400 hover:text-green-600 transition-colors">
                            <i data-lucide="save" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="mb-4 relative" x-data="{ open: false, query: '' }">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Search Saved
                            Customers</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-lucide="search" class="w-4 h-4 text-slate-400"></i>
                            </div>
                            <input type="text" x-model="query" @focus="open = true" @click.away="open = false"
                                placeholder="Type to search..."
                                class="w-full border border-slate-200 rounded-lg pl-9 pr-4 py-2 text-sm text-slate-700 outline-none focus:ring-2 focus:ring-blue-500 bg-slate-50 transition-all">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400"></i>
                            </div>
                        </div>

                        <!-- Dropdown Items -->
                        <div x-show="open" style="display: none;"
                            class="absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-60 overflow-auto">
                            <template
                                x-if="masterData.customers.filter(c => c.name.toLowerCase().includes(query.toLowerCase())).length === 0">
                                <div class="px-4 py-3 text-sm text-slate-500 italic text-center">No customers found.
                                </div>
                            </template>
                            <template
                                x-for="c in masterData.customers.filter(c => c.name.toLowerCase().includes(query.toLowerCase()))"
                                :key="c.name">
                                <div @click="selectCustomerObj(c); open = false; query = ''"
                                    class="px-4 py-2 hover:bg-blue-50 cursor-pointer border-b border-slate-50 last:border-0 group">
                                    <div class="font-bold text-slate-800 text-sm group-hover:text-blue-700"
                                        x-text="c.name"></div>
                                    <div class="text-[10px] text-slate-500 truncate" x-text="c.address"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Customer Name</label>
                            <input type="text" x-model="doc.customer.name" placeholder="M/S Shiv Engineering"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Address</label>
                            <textarea x-model="doc.customer.address" rows="3"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">State</label>
                                <input type="text" x-model="doc.customer.state"
                                    class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">GSTIN</label>
                                <input type="text" x-model="doc.customer.gstin"
                                    class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none text-xs">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">PAN No</label>
                            <input type="text" x-model="doc.customer.pan"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Logistics & Terms (Conditional) -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="heading-font text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i data-lucide="truck" class="w-5 h-5 mr-2 text-blue-500"></i>
                        <span x-text="doc.type === 'Quotation' ? 'Quotation Terms' : 'Logistics'"></span>
                    </h2>
                    <div class="space-y-4">
                        <template x-if="doc.type === 'Quotation'">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Validity End
                                        Date</label>
                                    <input type="date" x-model="doc.validityDate"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Payment Terms</label>
                                    <select x-model="doc.paymentTerms"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option value="100% Advance">100% Advance</option>
                                        <option value="100% Within 7 Days">100% Within 7 Days</option>
                                        <option value="100% Within 10 Days">100% Within 10 Days</option>
                                        <option value="100% Within 15 Days">100% Within 15 Days</option>
                                        <option value="100% Within 21 Days">100% Within 21 Days</option>
                                        <option value="100% Within 30 Days">100% Within 30 Days</option>
                                        <option value="100% Within 45 Days">100% Within 45 Days</option>
                                        <option value="100% Within 60 Days">100% Within 60 Days</option>
                                    </select>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Delivery
                                            Time</label>
                                        <select x-model="doc.deliveryTime"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="Within 7 Days">Within 7 Days</option>
                                            <option value="Within 10 Days">Within 10 Days</option>
                                            <option value="Within 30 Days">Within 30 Days</option>
                                            <option value="Within 45 Days">Within 45 Days</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Delivery
                                            Mode</label>
                                        <select x-model="doc.deliveryMode"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="By Courier/Hand">By Courier/Hand</option>
                                            <option value="By Email">By Email</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="doc.type === 'Proforma Invoice'">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order /
                                        Contract
                                        No</label>
                                    <input type="text" x-model="doc.poNumber"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order
                                            Date</label>
                                        <input type="date" x-model="doc.poDate"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Due Date</label>
                                        <input type="date" x-model="doc.dueDate"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="doc.type === 'Tax Invoice'">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order /
                                        Contract
                                        No</label>
                                    <input type="text" x-model="doc.poNumber"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order
                                            Date</label>
                                        <input type="date" x-model="doc.poDate"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Due Date</label>
                                        <input type="date" x-model="doc.dueDate"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="doc.type === 'Delivery Challan'">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order /
                                        Contract
                                        No</label>
                                    <input type="text" x-model="doc.poNumber"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-1">Purchase Order
                                            Date</label>
                                        <input type="date" x-model="doc.poDate"
                                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="doc.type === 'Credit Note' || doc.type === 'Debit Note'">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Original Invoice
                                        No.</label>
                                    <input type="text" x-model="doc.originalInvoiceNo"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Original Invoice
                                        Date</label>
                                    <input type="date" x-model="doc.originalInvoiceDate"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-600 mb-1">Reason for
                                        Issue</label>
                                    <select x-model="doc.reasonForIssue"
                                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option value="">Select Reason</option>
                                        <option value="Sales Return">Sales Return</option>
                                        <option value="Post Sales Discount">Post Sales Discount</option>
                                        <option value="Deficiency in services">Deficiency in services</option>
                                        <option value="Correction in Invoice">Correction in Invoice</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Subject & Reference -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
                    x-show="doc.type === 'Quotation'">
                    <h2 class="heading-font text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i data-lucide="info" class="w-5 h-5 mr-2 text-blue-500"></i>
                        Additional Information
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Subject</label>
                            <input type="text" x-model="doc.subject" placeholder="AERMOD View AMC for One Year"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Reference</label>
                            <input type="text" x-model="doc.reference" placeholder="To your email enquiry Dated..."
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Items -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="heading-font text-lg font-bold text-slate-800 flex items-center">
                            <i data-lucide="list" class="w-5 h-5 mr-2 text-blue-500"></i>
                            Line Items
                        </h2>
                        <div class="flex items-center space-x-2">
                            <button @click="saveToMaster('product')" title="Update all to Master"
                                class="p-1.5 text-slate-400 hover:text-green-600 transition-colors">
                                <i data-lucide="save" class="w-4 h-4"></i>
                            </button>
                            <button @click="addItem()"
                                class="text-blue-600 hover:text-blue-700 flex items-center font-medium text-sm">
                                <i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i>
                                Add Item
                            </button>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <template x-for="(item, index) in doc.items" :key="index">
                            <div class="p-4 bg-slate-50 rounded-xl relative border border-slate-100 group">
                                <button @click="removeItem(index)"
                                    class="absolute -top-2 -right-2 bg-red-100 text-red-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between space-x-2 relative"
                                        x-data="{ open: false }">
                                        <div class="flex-1 relative">
                                            <input type="text" x-model="item.desc"
                                                placeholder="Product name / Service (Type to search)"
                                                @focus="open = true" @click.away="open = false" @input="open = true"
                                                class="w-full bg-transparent font-medium text-slate-800 border-b border-slate-200 outline-none focus:border-blue-500 py-1"
                                                autocomplete="off">

                                            <!-- Autosuggest Dropdown -->
                                            <div x-show="open" style="display: none;"
                                                class="absolute z-20 left-0 mt-1 w-full bg-white shadow-xl rounded-lg border border-slate-100 max-h-48 overflow-auto min-w-[200px]">
                                                <template
                                                    x-for="p in masterData.products.filter(p => p.desc.toLowerCase().includes((item.desc || '').toLowerCase()))"
                                                    :key="p.desc">
                                                    <div @click="selectProductObj(index, p); open = false"
                                                        class="px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-slate-50 last:border-0">
                                                        <div class="font-bold text-slate-700 text-sm" x-text="p.desc">
                                                        </div>
                                                        <div
                                                            class="flex justify-between text-[10px] text-slate-400 mt-0.5">
                                                            <span x-text="'HSN: ' + p.hsn"></span>
                                                            <span class="font-mono text-slate-600"
                                                                x-text="getCurrencySymbol() + p.rate"></span>
                                                        </div>
                                                    </div>
                                                </template>
                                                <div x-show="masterData.products.filter(p => p.desc.toLowerCase().includes((item.desc || '').toLowerCase())).length === 0"
                                                    class="p-2 text-[10px] text-slate-400 italic text-center">
                                                    No matches found
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-5 gap-2">
                                        <div>
                                            <label class="text-[10px] text-slate-500 uppercase">HSN</label>
                                            <input type="text" x-model="item.hsn"
                                                class="w-full bg-transparent border-b border-slate-200 outline-none py-1 text-sm input-focus-effect">
                                        </div>
                                        <div>
                                            <label class="text-[10px] text-slate-500 uppercase">Qty</label>
                                            <input type="number" x-model="item.qty"
                                                class="w-full bg-transparent border-b border-slate-200 outline-none py-1 text-sm input-focus-effect">
                                        </div>
                                        <div>
                                            <label class="text-[10px] text-slate-500 uppercase">Rate</label>
                                            <input type="number" x-model="item.rate"
                                                class="w-full bg-transparent border-b border-slate-200 outline-none py-1 text-sm input-focus-effect">
                                        </div>
                                        <div>
                                            <label class="text-[10px] text-slate-500 uppercase">Tax %</label>
                                            <select x-model.number="item.taxRate"
                                                class="w-full bg-transparent border-b border-slate-200 outline-none py-1 text-sm input-focus-effect">
                                                <option value="0">0%</option>
                                                <option value="5">5%</option>
                                                <option value="18">18%</option>
                                                <option value="40">40%</option>
                                            </select>
                                        </div>
                                        <div x-show="doc.type === 'Quotation'">
                                            <label class="text-[10px] text-slate-500 uppercase">Disc %</label>
                                            <input type="number" x-model="item.discount"
                                                class="w-full bg-transparent border-b border-slate-200 outline-none py-1 text-sm input-focus-effect">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Bank Details -->
                <div x-show="doc.type !== 'Delivery Challan'"
                    class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="heading-font text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i data-lucide="building-2" class="w-5 h-5 mr-2 text-blue-500"></i>
                        Bank Details
                    </h2>

                    <!-- Bank Charges (fixed) - shown only for USD/EUR -->
                    <div x-show="['USD','EUR'].includes(doc.currency)" class="mb-3">
                        <label class="block text-sm font-medium text-slate-600 mb-1">Bank Charges (fixed)</label>
                        <div class="relative">
                            <input type="number" min="0" x-model.number="doc.bankChargesAmount"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm font-bold"
                                x-text="getCurrencySymbol()"></div>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">Fixed bank charge applied for selected currency. Editable
                            per document.</p>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Name</label>
                            <input type="text" x-model="doc.banks[doc.currency].name"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Bank</label>
                            <input type="text" x-model="doc.banks[doc.currency].bankName"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">Acc. Number</label>
                            <input type="text" x-model="doc.banks[doc.currency].acc"
                                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Branch</label>
                                <input type="text" x-model="doc.banks[doc.currency].branch"
                                    class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">IFSC Code</label>
                                <input type="text" x-model="doc.banks[doc.currency].ifsc"
                                    class="w-full border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms & Conditions -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="heading-font text-lg font-bold text-slate-800 flex items-center">
                            <i data-lucide="file-text" class="w-5 h-5 mr-2 text-blue-500"></i>
                            Terms & Conditions
                        </h2>
                        <button @click="addTnc()"
                            class="text-blue-600 hover:text-blue-700 flex items-center font-medium text-sm">
                            <i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i>
                            Add Point
                        </button>
                    </div>
                    <div class="space-y-3">
                        <template x-for="(point, index) in doc.tnc" :key="index">
                            <div class="flex items-start group">
                                <span class="text-slate-400 mt-2 mr-2 text-xs" x-text="(index + 1) + '.'"></span>
                                <div class="flex-1 relative">
                                    <textarea x-model="doc.tnc[index]" rows="1"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-sm text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                                        @input="$el.style.height = 'auto'; $el.style.height = $el.scrollHeight + 'px'"></textarea>
                                    <button @click="removeTnc(index)"
                                        class="absolute -right-2 -top-2 bg-red-100 text-red-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="lg:w-2/3 overflow-y-auto lg:max-h-[calc(100vh-140px)] max-h-[calc(100vh-140px)] pr-2 no-print">
                <div id="document-preview" class="bg-white shadow-2xl mx-auto print-area overflow-visible"
                    style="width: 210mm; min-height: 296mm; padding: 10mm; box-sizing: border-box; margin-bottom: 0;">

                    <!-- Template from Image recreation starts here -->
                    <div class="relative h-full text-[12px] leading-tight text-slate-900 border border-black p-4">

                        <!-- Header with Logo and Company Info -->
                        <div class="flex justify-between items-start mb-4 border-b-4 border-teal-600 pb-2">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3">
                                    <img src="laga-name.png" alt="LaGa Systems Pvt Ltd â€” House of Scientific Softwares"
                                        class="h-14 object-contain">
                                    <span class="sr-only">LaGa Systems Pvt Ltd â€” House of Scientific Softwares</span>
                                </div>
                                <div class="mt-2 text-slate-700">
                                    <p x-text="doc.company.address1"></p>
                                    <p x-text="doc.company.address2"></p>
                                    <p>CIN: <span x-text="doc.company.cin"></span></p>
                                    <div class="flex items-center space-x-3 mt-1 text-[11px] font-medium">
                                        <div class="flex items-center space-x-1">
                                            <i data-lucide="phone" class="w-3 h-3 text-slate-500"></i>
                                            <span x-text="doc.company.phone"></span>
                                        </div>
                                        <span class="text-slate-300">|</span>
                                        <div class="flex items-center space-x-1">
                                            <i data-lucide="globe" class="w-3 h-3 text-slate-500"></i>
                                            <span x-text="doc.company.website"></span>
                                        </div>
                                        <span class="text-slate-300">|</span>
                                        <div class="flex items-center space-x-1">
                                            <i data-lucide="mail" class="w-3 h-3 text-slate-500"></i>
                                            <span x-text="doc.company.email"></span>
                                        </div>
                                        <span class="text-slate-300">|</span>
                                        <div class="flex items-center space-x-1">
                                            <i data-lucide="building" class="w-3 h-3 text-slate-500"></i>
                                            <span x-text="doc.company.udyam"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right flex flex-col items-end">
                                <div class="w-16 h-16 flex items-center justify-center mb-1">
                                    <img src="logo.png" alt="Company Logo" class="max-w-full max-h-full object-contain">
                                </div>
                            </div>
                        </div>

                        <!-- Doc Title and PAN -->
                        <div class="grid grid-cols-3 border border-black mb-4 items-center">
                            <div class="p-1 border-r border-black font-bold text-[10px] leading-tight">
                                <div>GST No: <span x-text="doc.company.gstin"></span></div>
                                <div>PAN No: <span x-text="doc.company.pan"></span></div>
                            </div>
                            <div class="p-1 border-r border-black text-center font-bold text-base uppercase"
                                x-text="doc.customTitle || doc.type">TAX INVOICE</div>
                            <div class="p-1 text-[10px] font-bold text-center">ORIGINAL FOR RECIPIENT</div>
                        </div>

                        <!-- Customer & Invoice Details -->
                        <div class="grid grid-cols-2 border-x border-t border-black mb-0">
                            <div class="p-2 border-r border-black bg-slate-50">
                                <h3 class="font-bold border-b border-black mb-2 text-center text-[10px]">To</h3>
                                <table class="w-full text-left">
                                    <tr>
                                        <td class="font-bold w-16">Name</td>
                                        <td x-text="doc.customer.name"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold align-top">Address</td>
                                        <td class="leading-tight" x-text="doc.customer.address"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">State</td>
                                        <td x-text="doc.customer.state"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">GSTIN</td>
                                        <td x-text="doc.customer.gstin"></td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold">PAN No</td>
                                        <td x-text="doc.customer.pan || '-'"></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="grid grid-cols-2">
                                <div class="p-1 border-r border-b border-black">
                                    <p class="font-medium text-[9px] text-slate-500"
                                        x-text="doc.type == 'Quotation' ? 'Quotation No.' : (doc.type == 'Proforma Invoice' ? 'Proforma No.' : (doc.type === 'Tax Invoice' ? 'Invoice No.' : (doc.type === 'Credit Note' ? 'Credit Note No.' : (doc.type === 'Debit Note' ? 'Debit Note No.' : 'Challan No.'))))">
                                    </p>
                                    <p class="font-bold" x-text="doc.number"></p>
                                </div>
                                <div class="p-1 border-b border-black">
                                    <p class="font-medium text-[9px] text-slate-500"
                                        x-text="doc.type == 'Quotation' ? 'Quotation Date' : (doc.type == 'Proforma Invoice' ? 'Proforma Date' : (doc.type === 'Tax Invoice' ? 'Invoice Date' : (doc.type === 'Credit Note' ? 'Credit Note Date' : (doc.type === 'Debit Note' ? 'Debit Note Date' : 'Challan Date'))))">
                                    </p>
                                    <p class="font-bold" x-text="formatDate(doc.date)"></p>
                                </div>

                                <!-- Dynamic Layout for Quotation vs Invoice -->
                                <template x-if="doc.type === 'Quotation'">
                                    <div class="contents">
                                        <div class="p-1 border-r border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Validity End Date</p>
                                            <p class="font-bold"
                                                x-text="doc.validityDate ? formatDate(doc.validityDate) : '-'"></p>
                                        </div>
                                        <div class="p-1 border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Payment Terms</p>
                                            <p class="font-bold" x-text="doc.paymentTerms || '-'"></p>
                                        </div>
                                        <div class="p-1 border-r border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Delivery Time</p>
                                            <p class="font-bold" x-text="doc.deliveryTime || '-'"></p>
                                        </div>
                                        <div class="p-1">
                                            <p class="font-medium text-[9px] text-slate-500">Delivery Mode</p>
                                            <p class="font-bold" x-text="doc.deliveryMode || '-'"></p>
                                        </div>
                                    </div>
                                </template>
                                <template
                                    x-if="['Proforma Invoice', 'Tax Invoice', 'Delivery Challan'].includes(doc.type)">
                                    <div class="contents">
                                        <div class="p-1 border-r border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Purchase Order / Contract
                                                No
                                            </p>
                                            <p class="font-bold" x-text="doc.poNumber || '-'"></p>
                                        </div>
                                        <div class="p-1 border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Purchase Order Date</p>
                                            <p class="font-bold" x-text="doc.poDate ? formatDate(doc.poDate) : '-'"></p>
                                        </div>
                                        <div class="p-1 border-r border-black" x-show="doc.type !== 'Delivery Challan'">
                                            <p class="font-medium text-[9px] text-slate-500">Due Date</p>
                                            <p class="font-bold" x-text="doc.dueDate ? formatDate(doc.dueDate) : '-'">
                                            </p>
                                        </div>
                                        <div class="p-1" x-show="doc.type !== 'Delivery Challan'">
                                        </div>
                                    </div>
                                </template>
                                <template x-if="['Credit Note', 'Debit Note'].includes(doc.type)">
                                    <div class="contents">
                                        <div class="p-1 border-r border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Original Invoice No.</p>
                                            <p class="font-bold" x-text="doc.originalInvoiceNo || '-'"></p>
                                        </div>
                                        <div class="p-1 border-b border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Original Invoice Date</p>
                                            <p class="font-bold"
                                                x-text="doc.originalInvoiceDate ? formatDate(doc.originalInvoiceDate) : '-'">
                                            </p>
                                        </div>
                                        <div class="p-1 border-r border-black">
                                            <p class="font-medium text-[9px] text-slate-500">Reason for Issue</p>
                                            <p class="font-bold" x-text="doc.reasonForIssue || '-'"></p>
                                        </div>
                                        <div class="p-1">
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Subject and Reference Section -->
                        <div class="border-x border-t border-b border-black" x-show="doc.type === 'Quotation'">
                            <table class="w-full text-left border-collapse">
                                <tr class="border-b border-black">
                                    <td class="p-1 font-bold w-16 border-r border-black">Subject</td>
                                    <td class="p-1 font-medium" x-text="doc.subject"></td>
                                </tr>
                                <tr>
                                    <td class="p-1 font-bold w-16 border-r border-black">Reference</td>
                                    <td class="p-1 font-medium" x-text="doc.reference"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Item Table -->
                        <table class="pdf-table text-center mb-0">
                            <thead class="bg-slate-50 font-bold text-[10px]">
                                <tr>
                                    <th class="p-1 w-8">Sr.<br>No.</th>
                                    <th class="p-1 w-64">Name of Product / Service</th>
                                    <th class="p-1">HSN / SAC</th>
                                    <th class="p-1">Qty</th>
                                    <th class="p-1">Rate</th>
                                    <th class="p-1" x-show="doc.type === 'Quotation' && hasDiscount()">
                                        Disc %</th>
                                    <th class="p-1">Taxable Value</th>
                                    <th class="p-1" colspan="2">
                                        <div class="border-b-[0.5px] border-[#334155]"
                                            x-text="isInterstate() ? 'IGST' : 'CGST/SGST'">
                                        </div>
                                        <div class="grid grid-cols-2"><span>%</span><span>Amount</span></div>
                                    </th>
                                    <th class="p-1">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(item, index) in doc.items">
                                    <tr>
                                        <td class="p-1" x-text="index + 1"></td>
                                        <td class="p-1 text-left" x-text="item.desc"></td>
                                        <td class="p-1" x-text="item.hsn"></td>
                                        <td class="p-1" x-text="item.qty"></td>
                                        <td class="p-1" x-text="formatCurrency(item.rate)"></td>
                                        <td class="p-1" x-text="item.discount || '0'"
                                            x-show="doc.type === 'Quotation' && hasDiscount()"></td>
                                        <td class="p-1" x-text="formatCurrency(itemTaxableValue(item))"></td>
                                        <td class="p-1"
                                            x-text="isInterstate() ? formatPercent((item.taxRate !== undefined) ? item.taxRate : (doc.taxRate || 18)) : formatSplitPercent((item.taxRate !== undefined) ? item.taxRate : (doc.taxRate || 18))">
                                        </td>
                                        <td class="p-1" x-text="formatCurrency(itemTaxAmount(item))">
                                        </td>
                                        <td class="p-1" x-text="formatCurrency(itemTotal(item))">
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                            <tfoot class="border-t-[0.5px] border-[#334155] bg-slate-50 font-bold">
                                <tr>
                                    <td colspan="3" class="text-right p-1">Total</td>
                                    <td x-text="totalQty()"></td>
                                    <td class="bg-gray-200"></td>
                                    <td class="bg-gray-200" x-show="doc.type === 'Quotation' && hasDiscount()"></td>
                                    <td x-text="formatCurrency(subTotal())"></td>
                                    <td class="bg-gray-200"></td>
                                    <td x-text="formatCurrency(taxAmount())"></td>
                                    <td x-text="formatCurrency(grandTotal())"></td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Summary & Bank Details -->
                        <div class="grid grid-cols-2 border border-black border-t-0">
                            <div class="border-r border-black flex flex-col">
                                <div class="p-2 border-b border-black text-center font-bold bg-slate-50 text-[10px]">
                                    Total
                                    in words</div>
                                <div class="p-4 flex-1 flex items-center justify-center text-center font-bold uppercase leading-tight"
                                    x-text="numberToWords(grandTotal(), doc.currency)">
                                </div>
                                <div x-show="doc.type !== 'Delivery Challan'" class="contents">
                                    <div
                                        class="p-1 border-t border-black text-center font-bold bg-slate-50 text-[10px]">
                                        Bank
                                        Details</div>
                                    <div class="p-2 text-[10px] grid grid-cols-2 gap-y-1">
                                        <div class="font-bold">Name</div>
                                        <div x-text="bankForCurrency().name"></div>
                                        <div class="font-bold">Acc. Number</div>
                                        <div x-text="bankForCurrency().acc"></div>
                                        <div class="font-bold">Bank</div>
                                        <div x-text="bankForCurrency().bankName"></div>
                                        <div class="font-bold">Branch</div>
                                        <div x-text="bankForCurrency().branch"></div>
                                        <div class="font-bold">IFSC Code</div>
                                        <div x-text="bankForCurrency().ifsc"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <table class="w-full text-right text-[11px]">
                                    <tr class="border-b border-black">
                                        <td class="p-1 text-left font-bold">Taxable Amount</td>
                                        <td class="p-1" x-text="formatCurrency(subTotal())"></td>
                                    </tr>
                                    <template x-if="isInterstate()">
                                        <tr class="border-b border-black">
                                            <td class="p-1 text-left font-bold"
                                                x-text="summaryTaxRate() !== null ? ('Add : IGST (' + formatPercent(summaryTaxRate()) + ')') : 'Add : IGST (Varied)'">
                                            </td>
                                            <td class="p-1" x-text="formatCurrency(igstAmount())"></td>
                                        </tr>
                                    </template>
                                    <template x-if="!isInterstate()">
                                        <tr class="border-b border-black">
                                            <td class="p-1 text-left font-bold"
                                                x-text="summaryTaxRate() !== null ? ('Add : CGST (' + formatPercent(summaryTaxRate()/2) + ')') : 'Add : CGST (Varied)'">
                                            </td>
                                            <td class="p-1" x-text="formatCurrency(cgstAmount())"></td>
                                        </tr>
                                    </template>
                                    <template x-if="!isInterstate()">
                                        <tr class="border-b border-black">
                                            <td class="p-1 text-left font-bold"
                                                x-text="summaryTaxRate() !== null ? ('Add : SGST (' + formatPercent(summaryTaxRate()/2) + ')') : 'Add : SGST (Varied)'">
                                            </td>
                                            <td class="p-1" x-text="formatCurrency(sgstAmount())"></td>
                                        </tr>
                                    </template>
                                    <tr class="border-b border-black" x-show="bankChargesValue() > 0">
                                        <td class="p-1 text-left font-bold">Bank Charges</td>
                                        <td class="p-1"
                                            x-text="getCurrencySymbol() + ' ' + formatCurrency(bankChargesValue())">
                                        </td>
                                    </tr>
                                    <tr class="border-b border-black">
                                        <td class="p-1 text-left font-bold">Total Tax</td>
                                        <td class="p-1" x-text="formatCurrency(taxAmount())"></td>
                                    </tr>
                                    <tr class="border-b border-black" x-show="Math.abs(roundOff()) > 0.01">
                                        <td class="p-1 text-left font-bold">Round Off</td>
                                        <td class="p-1" x-text="formatCurrency(roundOff())"></td>
                                    </tr>
                                    <tr class="border-b border-black bg-slate-100">
                                        <td class="p-1 text-left font-bold text-lg">Total Amount</td>
                                        <td class="p-1 text-lg font-black"
                                            x-text="getCurrencySymbol() + ' ' + formatCurrency(grandTotal())">
                                        </td>
                                    </tr>
                                </table>
                                <div class="p-2 text-center text-[9px] italic flex-1 flex flex-col justify-end">
                                    <p class="mb-8 font-bold text-slate-800">Certified that the particulars given above
                                        are
                                        true and correct.</p>
                                    <p class="font-bold text-slate-900 border-t border-black pt-1">For <span
                                            x-text="doc.company.name"></span>
                                    </p>
                                    <div class="mt-2 flex flex-col items-center min-h-[80px] justify-end relative">
                                        <div class="flex items-end justify-center space-x-4 mb-2 relative">
                                            <!-- Company Stamp -->
                                            <template x-if="doc.settings.showCompanyStamp">
                                                <img src="company_stamp.png" class="h-16 object-contain"
                                                    alt="Company Stamp">
                                            </template>

                                            <!-- Signature -->
                                            <template x-if="doc.settings.showSignature">
                                                <!-- If both are shown, add negative margin to overlap slightly for realism -->
                                                <img src="signature.png" class="h-12 object-contain"
                                                    :class="doc.settings.showCompanyStamp ? '-ml-8 z-10' : ''"
                                                    alt="Signature">
                                            </template>

                                            <!-- Revenue Stamp (Only for Tax Invoice) -->
                                            <template
                                                x-if="doc.settings.showRevenueStamp && doc.type === 'Tax Invoice'">
                                                <img src="stamp.png" class="h-20 object-contain ml-4"
                                                    alt="Revenue Stamp">
                                            </template>
                                        </div>
                                        <div
                                            class="border-t border-black pt-1 font-bold w-full text-center uppercase text-[10px]">
                                            Authorised Signatory</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Footer T&C -->
                        <div class="border border-black border-t-0 p-2 text-[9px]">
                            <p class="font-bold uppercase mb-1">Terms and Conditions</p>
                            <ol class="list-decimal ml-5 space-y-1">
                                <template x-for="point in doc.tnc">
                                    <li class="pl-1" x-text="point"></li>
                                </template>
                            </ol>
                        </div>

                        <!-- Audit Trailer -->
                        <!-- Audit Trailer -->
                        <div class="text-center mt-2 font-bold text-slate-600" x-show="doc.type === 'Quotation'">Thank
                            you
                            for your consideration, and we
                            eagerly anticipate the opportunity to fulfil your esteemed order!
                        </div>
                        <div
                            class="mt-4 pt-2 border-t border-slate-100 flex flex-col items-end text-[8px] font-medium text-slate-400 italic">
                            <span x-text="getAuditStamp()"></span>

                        </div>


                    </div>
                </div>
            </div>
        </div>

        <!-- GST Return Detail Modal -->
        <div x-show="showGstHistoryDetail"
            class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100">
            <div class="bg-white rounded-[32px] shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col border border-slate-200"
                @click.away="showGstHistoryDetail = false">

                <!-- Modal Header -->
                <div class="p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                    <div>
                        <div class="flex items-center space-x-3 mb-1">
                            <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase"
                                :class="selectedGstReturn?.type === 'GSTR-1' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'"
                                x-text="selectedGstReturn?.type"></span>
                            <h2 class="text-2xl font-black text-slate-900"
                                x-text="'Return for ' + selectedGstReturn?.period"></h2>
                        </div>
                        <p class="text-slate-500 text-sm font-medium"
                            x-text="'Saved on ' + formatDate(selectedGstReturn?.created_at)"></p>
                    </div>
                    <button @click="showGstHistoryDetail = false"
                        class="p-3 bg-white border border-slate-200 rounded-2xl hover:bg-slate-50 transition-all shadow-sm">
                        <i data-lucide="x" class="w-6 h-6 text-slate-400"></i>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-8 overflow-y-auto flex-1 space-y-8 bg-slate-50/20">

                    <!-- GSTR-1 View -->
                    <template x-if="selectedGstReturn?.type === 'GSTR-1'">
                        <div class="space-y-6">
                            <!-- B2B Table -->
                            <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                                <div class="px-6 py-4 border-b border-slate-100 bg-slate-50">
                                    <h3 class="font-black text-xs uppercase text-slate-500">B2B Invoices</h3>
                                </div>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="text-[10px] font-black uppercase text-slate-400 border-b border-slate-100">
                                            <th class="py-3 px-6">Invoice</th>
                                            <th class="py-3 px-6">GSTIN</th>
                                            <th class="py-3 px-6 text-right">Taxable</th>
                                            <th class="py-3 px-6 text-right">GST</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-xs font-bold text-slate-700">
                                        <template x-for="inv in selectedGstReturn?.data?.details?.b2b">
                                            <tr class="border-b border-slate-50">
                                                <td class="py-3 px-6" x-text="inv.number"></td>
                                                <td class="py-3 px-6 x-text='inv.gstin'"></td>
                                                <td class="py-3 px-6 text-right" x-text="formatCurrency(inv.taxable)">
                                                </td>
                                                <td class="py-3 px-6 text-right" x-text="formatCurrency(inv.gst)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>

                            <!-- HSN Table -->
                            <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                                <div class="px-6 py-4 border-b border-slate-100 bg-slate-50">
                                    <h3 class="font-black text-xs uppercase text-slate-500">Section 12 - HSN Summary
                                    </h3>
                                </div>
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr
                                            class="text-[10px] font-black uppercase text-slate-400 border-b border-slate-100">
                                            <th class="py-3 px-6">HSN</th>
                                            <th class="py-3 px-6 text-right">Qty</th>
                                            <th class="py-3 px-6 text-right">Taxable</th>
                                            <th class="py-3 px-6 text-right">Tax</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-xs font-bold text-slate-700">
                                        <template x-for="h in selectedGstReturn?.data?.hsn">
                                            <tr class="border-b border-slate-50">
                                                <td class="py-3 px-6" x-text="h.hsn"></td>
                                                <td class="py-3 px-6 text-right" x-text="h.qty"></td>
                                                <td class="py-3 px-6 text-right" x-text="formatCurrency(h.taxable)">
                                                </td>
                                                <td class="py-3 px-6 text-right"
                                                    x-text="formatCurrency(h.iamt + h.camt + h.samt)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </template>

                    <!-- GSTR-3B View -->
                    <template x-if="selectedGstReturn?.type === 'GSTR-3B'">
                        <div class="space-y-6">
                            <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                                <div class="px-6 py-4 border-b border-slate-100 bg-slate-50">
                                    <h3 class="font-black text-xs uppercase text-slate-500">Table 3.1 - Outward Supplies
                                    </h3>
                                </div>
                                <div class="p-6">
                                    <div class="flex justify-between items-center py-4 border-b border-slate-50">
                                        <span class="text-slate-600 font-bold">Total Taxable Value</span>
                                        <span class="text-xl font-black text-slate-900"
                                            x-text="formatCurrency(selectedGstReturn?.data?.table31?.a?.val)"></span>
                                    </div>
                                    <div class="flex justify-between items-center py-4">
                                        <span class="text-slate-600 font-bold">Integrated Tax (IGST)</span>
                                        <span class="text-xl font-black text-blue-600"
                                            x-text="formatCurrency(selectedGstReturn?.data?.table31?.a?.tax)"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                </div>

                <!-- Modal Footer -->
                <div class="p-6 border-t border-slate-100 bg-slate-50 flex justify-end">
                    <button @click="showGstHistoryDetail = false"
                        class="px-8 py-3 bg-slate-900 text-white rounded-2xl font-black hover:bg-slate-800 transition-all">Close
                        Viewer</button>
                </div>
            </div>
        </div>
        <!-- Document Viewer Modal -->
        <div x-show="showDocViewer"
            class="fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-8 overflow-y-auto"
            x-transition.opacity>
            <div class="bg-slate-100 rounded-3xl shadow-xl w-full max-w-5xl overflow-hidden flex flex-col h-[90vh]"
                @click.away="showDocViewer = false">
                <!-- Header -->
                <div
                    class="px-8 py-4 bg-white border-b border-slate-200 flex justify-between items-center sticky top-0 z-10">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-blue-50 rounded-lg">
                            <i data-lucide="file-text" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <div>
                            <h3 class="font-black text-slate-800 text-lg">Document Viewer</h3>
                            <p class="text-xs text-slate-400 font-bold" x-text="viewDoc ? viewDoc.number : ''"></p>
                        </div>
                    </div>
                    <button @click="showDocViewer = false"
                        class="p-2 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>

                <!-- Content -->
                <div class="flex-1 overflow-y-auto p-8" x-if="viewDoc">
                    <div
                        class="bg-white shadow-sm border border-slate-100 min-h-[1000px] w-full max-w-4xl mx-auto p-12 relative flex flex-col">
                        <!-- Company Header -->
                        <div class="flex justify-between items-start mb-12">
                            <div class="flex items-start space-x-6">
                                <div class="w-20 h-20 bg-slate-100 rounded-2xl overflow-hidden">
                                    <template x-if="companyLogo">
                                        <img :src="companyLogo" class="w-full h-full object-cover">
                                    </template>
                                </div>
                                <div>
                                    <h1 class="text-2xl font-black text-slate-900 mb-1" x-text="companyDetails.name">
                                    </h1>
                                    <p class="text-sm text-slate-500 font-medium leading-relaxed max-w-[250px]"
                                        x-text="companyDetails.address"></p>
                                    <p class="text-sm text-slate-500 font-medium mt-1">
                                        GSTIN: <span class="font-bold text-slate-700"
                                            x-text="companyDetails.gstin"></span>
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <h2 class="text-4xl font-black text-blue-600 uppercase tracking-tight mb-2"
                                    x-text="viewDoc.type"></h2>
                                <p class="text-sm font-bold text-slate-400 mb-1">Original for Recipient</p>
                                <div class="bg-blue-50 rounded-xl px-4 py-2 inline-block">
                                    <p class="text-xs font-black text-blue-400 uppercase tracking-widest mb-1">Document
                                        No</p>
                                    <p class="text-lg font-black text-blue-900" x-text="viewDoc.number"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Bill To / details -->
                        <div class="grid grid-cols-2 gap-12 mb-12">
                            <div>
                                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Billed To
                                </p>
                                <h3 class="text-lg font-bold text-slate-900 mb-1" x-text="viewDoc.customer.name"></h3>
                                <p class="text-sm text-slate-500 font-medium leading-relaxed mb-2"
                                    x-text="viewDoc.customer.billingAddress"></p>
                                <p class="text-sm text-slate-500 font-medium">GSTIN: <span
                                        class="font-bold text-slate-700" x-text="viewDoc.customer.gstin"></span></p>
                            </div>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center py-2 border-b border-slate-100">
                                    <span class="text-sm font-bold text-slate-400">Date</span>
                                    <span class="text-sm font-black text-slate-700"
                                        x-text="formatDate(viewDoc.date)"></span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-slate-100"
                                    x-show="viewDoc.dueDate">
                                    <span class="text-sm font-bold text-slate-400">Due Date</span>
                                    <span class="text-sm font-black text-slate-700"
                                        x-text="formatDate(viewDoc.dueDate)"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Items Table -->
                        <table class="w-full mb-8">
                            <thead>
                                <tr class="bg-slate-50 text-left">
                                    <!-- Items Table -->
                                    <table class="w-full mb-8">
                                        <thead>
                                            <tr class="bg-slate-50 text-left">
                                                <th
                                                    class="py-3 px-4 text-xs font-black text-slate-400 uppercase tracking-widest rounded-l-xl">
                                                    Item</th>
                                                <th
                                                    class="py-3 px-4 text-xs font-black text-slate-400 uppercase tracking-widest text-right">
                                                    HSN</th>
                                                <th
                                                    class="py-3 px-4 text-xs font-black text-slate-400 uppercase tracking-widest text-right">
                                                    Qty</th>
                                                <th
                                                    class="py-3 px-4 text-xs font-black text-slate-400 uppercase tracking-widest text-right">
                                                    Rate</th>
                                                <th
                                                    class="py-3 px-4 text-xs font-black text-slate-400 uppercase tracking-widest text-right">
                                                    Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody class="text-sm">
                                            <template x-for="(item, index) in viewDoc.items" :key="index">
                                                <tr class="border-b border-slate-50">
                                                    <td class="py-4 px-4">
                                                        <p class="font-bold text-slate-700" x-text="item.desc"></p>
                                                    </td>
                                                    <td class="py-4 px-4 text-right text-xs text-slate-400"
                                                        x-text="item.hsn || '-'"></td>
                                                    <td class="py-4 px-4 text-right font-medium text-slate-600"
                                                        x-text="item.qty"></td>
                                                    <td class="py-4 px-4 text-right font-medium text-slate-600"
                                                        x-text="formatCurrency(item.rate)"></td>
                                                    <td class="py-4 px-4 text-right font-black text-slate-900"
                                                        x-text="formatCurrency(item.qty * item.rate)"></td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>

                                    <!-- Totals -->
                                    <div class="flex justify-end mb-12">
                                        <div class="w-64 space-y-3">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold text-slate-400">Subtotal</span>
                                                <span class="font-bold text-slate-700"
                                                    x-text="formatCurrency(viewDoc.totals?.subtotal || 0)"></span>
                                            </div>

                                            <!-- CGST/SGST -->
                                            <template x-if="viewDoc.totals?.cgst > 0">
                                                <div>
                                                    <div class="flex justify-between text-sm">
                                                        <span class="font-bold text-slate-400">CGST (9%)</span>
                                                        <span class="font-bold text-slate-700"
                                                            x-text="formatCurrency(viewDoc.totals?.cgst || 0)"></span>
                                                    </div>
                                                    <div class="flex justify-between text-sm mt-3">
                                                        <span class="font-bold text-slate-400">SGST (9%)</span>
                                                        <span class="font-bold text-slate-700"
                                                            x-text="formatCurrency(viewDoc.totals?.sgst || 0)"></span>
                                                    </div>
                                                </div>
                                            </template>

                                            <!-- IGST -->
                                            <template x-if="viewDoc.totals?.igst > 0">
                                                <div class="flex justify-between text-sm">
                                                    <span class="font-bold text-slate-400">IGST (18%)</span>
                                                    <span class="font-bold text-slate-700"
                                                        x-text="formatCurrency(viewDoc.totals?.igst || 0)"></span>
                                                </div>
                                            </template>

                                            <div
                                                class="pt-3 border-t-2 border-slate-100 flex justify-between items-center">
                                                <span class="font-black text-slate-900">Total</span>
                                                <span class="font-black text-xl text-blue-600"
                                                    x-text="formatCurrency(viewDoc.totals?.total || 0)"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Footer -->
                                    <div class="mt-auto pt-8 border-t border-slate-100 text-center">
                                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Authorized
                                            Signatory
                                        </p>
                                        <div class="h-16"></div>
                                        <p class="text-sm font-black text-slate-900" x-text="companyDetails.name"></p>
                                    </div>
                    </div>
                </div>

                <!-- Actions Footer -->
                <div class="p-6 bg-slate-50 border-t border-slate-200 flex justify-end space-x-4">
                    <button @click="showDocViewer = false"
                        class="px-6 py-3 font-bold text-slate-500 hover:text-slate-800 transition-colors">Close</button>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script>
        window.supabase = supabase.createClient(
            'https://gwoihyinysixdjfruobk.supabase.co',
            'sb_publishable_gtomxhUKvqap_H8PnW2qYw_ms952Ne6'
        );
    </script>

    <script src="app.js"></script>
</body>

</html>